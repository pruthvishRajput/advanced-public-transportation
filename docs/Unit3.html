

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extraction of trip travel time information &mdash; A demonstration of Advanced Urban Public Transportation System 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Arrival time prediction" href="Unit4.html" />
    <link rel="prev" title="Bus-stop detection" href="Unit2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> A demonstration of Advanced Urban Public Transportation System
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ReadMe.html">advanced-public-transportation-system</a></li>
<li class="toctree-l1"><a class="reference internal" href="SoftwareRequirement.html">Software requirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="Unit1.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Unit2.html">Bus-stop detection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extraction of trip travel time information</a></li>
<li class="toctree-l1"><a class="reference internal" href="Unit4.html">Arrival time prediction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">A demonstration of Advanced Urban Public Transportation System</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Extraction of trip travel time information</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Unit3.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Extraction-of-trip-travel-time-information">
<h1>Extraction of trip travel time information<a class="headerlink" href="#Extraction-of-trip-travel-time-information" title="Permalink to this headline">¶</a></h1>
<p>In the bus-stop detection section, we have applied the Density-Based Spatial Clustering of Applications with Noise (DBSCAN) based clustering algorithm to detect the bus-stops on a route. Now for developing the arrival time predictor scheme, we will need the travel time information of a bus at different bus-stops or junctions / crossroads. These travel time information will be used in the subsequent unit to built the arrival time predictor based on historical bus trajectories.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;Imports&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="k">import</span> <span class="n">MongoClient</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span> <span class="o">+</span><span class="s1">&#39;/Codes/LibCodes&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;Import project specific library&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">Preprocessing</span>

<span class="sd">&#39;&#39;&#39;Initialize MongoClient&#39;&#39;&#39;</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">()</span>

<span class="n">RouteName</span><span class="o">=</span><span class="s1">&#39;Git_ISCON_PDPU&#39;</span>
</pre></div>
</div>
</div>
<p>We begin by extracting the bus-stops and junction or crossroads on a route for both the direction i.e. from ISCON to PDPU (<em>North bound</em>) and PDPU to ISCON (<em>South bound</em>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;BusStops, use of ProcessStatus collection and record: BusStops:True&#39;&#39;&#39;</span>
<span class="n">BusStopsListNorth</span> <span class="o">=</span> <span class="p">[</span><span class="n">BusStop</span> <span class="k">for</span> <span class="n">BusStop</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;BusStops.NorthBound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])]</span>
<span class="c1">#New Addition for Dist_th</span>
<span class="n">BusStopsListSouth</span> <span class="o">=</span> <span class="p">[</span><span class="n">BusStop</span> <span class="k">for</span> <span class="n">BusStop</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;BusStops.SouthBound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])]</span>
<span class="n">Dist_TH</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
<p>Now, to compute travel time we compare the filtered location records with three consecutive bus-stops on a route. Because, we have observed that if the location record corresponding to a particular bus-stop is missing due to GPS outage, then the travel time extraction module would get stuck waiting for the location record corresponding to the bus-stop location. In order to cater with these types of an <em>occasional GPS outage</em>, we compare the location records with three consecutive bus-stop. If
the distance between the bus-stop location and location record is less than <span class="math notranslate nohighlight">\(D_{th}\)</span> meters (<span class="math notranslate nohighlight">\(50 m\)</span>), then the travel time extraction module marks the corresponding location record of the bus as the record at a bus-stop.</p>
<p>We need to emphasize that the <code class="docutils literal notranslate"><span class="pre">id</span></code> of bus-stop <em>increases</em> as the bus moves during its trip in the case of north bound whereas in the case of south bound the <code class="docutils literal notranslate"><span class="pre">id</span></code> of bus-stop <em>decreases</em> as the bus moves during its trip. Let us print the BusStopsListNorth and BusStopsListSouth to observe this point.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">([(</span><span class="n">BusStop</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span><span class="n">BusStop</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">BusStop</span> <span class="ow">in</span> <span class="n">BusStopsListSouth</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;ISCON&#39;, 0),
 (&#39;Pakwaan&#39;, 1),
 (&#39;Gurudwara&#39;, 2),
 (&#39;Thaltej&#39;, 3),
 (&#39;Zydus&#39;, 4),
 (&#39;Kargil&#39;, 5),
 (&#39;Sola&#39;, 6),
 (&#39;Gota&#39;, 7),
 (&#39;Vaishnodevi&#39;, 8),
 (&#39;Khoraj&#39;, 9),
 (&#39;Adalaj-uvarsad&#39;, 10),
 (&#39;Sargasan&#39;, 11),
 (&#39;RakshaShakti&#39;, 12),
 (&#39;Bhaijipura&#39;, 13),
 (&#39;PDPU&#39;, 14)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">BusStop</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span><span class="n">BusStop</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">BusStop</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;BusStops.SouthBound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;PDPU&#39;, 14),
 (&#39;Bhaijipura&#39;, 13),
 (&#39;RakshaShakti&#39;, 12),
 (&#39;Sargasan&#39;, 11),
 (&#39;Adalaj-uvarsad&#39;, 10),
 (&#39;Khoraj&#39;, 9),
 (&#39;Vaishnodevi&#39;, 8),
 (&#39;Gota&#39;, 7),
 (&#39;Sola&#39;, 6),
 (&#39;Kargil&#39;, 5),
 (&#39;Zydus&#39;, 4),
 (&#39;Thaltej&#39;, 3),
 (&#39;Gurudwara&#39;, 2),
 (&#39;Pakwaan&#39;, 1),
 (&#39;ISCON&#39;, 0)]
</pre></div></div>
</div>
<p>Therefore, we have formulated two functions separately for North bound and South bound to compute travel time estimates. One must emphasize on the condition and index using for North bound and South bound.</p>
<p>For north bound in function <code class="docutils literal notranslate"><span class="pre">ExtractTimeStampNorthBound</span></code>,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">BusStopIndex</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">BusStopsCount</span><span class="p">:</span>
<span class="sd">&#39;&#39;&#39;and&#39;&#39;&#39;</span>
<span class="n">BusStopsListNorth</span><span class="p">[</span><span class="n">BusStopIndex</span><span class="o">+</span><span class="n">j</span><span class="p">],</span>
</pre></div>
</div>
<p>and for south bound in function <code class="docutils literal notranslate"><span class="pre">ExtractTimeStampSouthBound</span></code>,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
<span class="sd">&#39;&#39;&#39;and&#39;&#39;&#39;</span>
<span class="n">BusStopsListSouth</span><span class="p">[</span><span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="p">]</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ExtractTimeStampNorthBound</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">,</span> <span class="n">BusStopsListNorth</span><span class="p">,</span> <span class="n">Dist_TH</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    input: Location records of the trip, bus-stop list, and distance threshold</span>
<span class="sd">    output: The dictionary of location records corresponding to bus</span>
<span class="sd">    function: Compares the location records of the trip with three consecutive</span>
<span class="sd">              bus-stop and if distance is less than Dist_TH then marks the corresponding</span>
<span class="sd">              record as a location record at a bus-stop.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">BusStopsTimeStampList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">BusStopIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LocationRecordsCount</span> <span class="o">=</span> <span class="nb">len</span> <span class="p">(</span><span class="n">LocationRecords</span><span class="p">)</span>
    <span class="n">BusStopsCount</span> <span class="o">=</span> <span class="nb">len</span> <span class="p">(</span><span class="n">BusStopsListNorth</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">LocationRecordsCount</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">BusStopIndex</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">BusStopsCount</span><span class="p">:</span>
                <span class="n">DistanceFromStop</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="o">.</span><span class="n">mydistance</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
                                              <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
                                              <span class="n">BusStopsListNorth</span><span class="p">[</span><span class="n">BusStopIndex</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;Location&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">BusStopsListNorth</span><span class="p">[</span><span class="n">BusStopIndex</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;Location&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">DistanceFromStop</span> <span class="o">&lt;</span> <span class="n">Dist_TH</span><span class="p">:</span>
                    <span class="n">BusStopDict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">BusStopIndex</span> <span class="o">+=</span> <span class="n">j</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BusStopIndex</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BusStopsListNorth</span><span class="p">[</span><span class="n">BusStopIndex</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">BusStopsTimeStampList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BusStopDict</span><span class="p">)</span>
                    <span class="n">BusStopIndex</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">BusStopIndex</span> <span class="o">==</span> <span class="n">BusStopsCount</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span><span class="p">(</span><span class="n">BusStopsTimeStampList</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ExtractTimeStampSouthBound</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">,</span> <span class="n">BusStopsListSouth</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    input: Location records of the trip, bus-stop list, and distance threshold</span>
<span class="sd">    output: The dictionary of location records corresponding to bus</span>
<span class="sd">    function: Compares the location records of the trip with three consecutive</span>
<span class="sd">              bus-stop and if distance is less than Dist_TH then marks the corresponding</span>
<span class="sd">              record as a location record at a bus-stop.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">BusStopsTimeStampList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">BusStopIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LocationRecordsCount</span> <span class="o">=</span> <span class="nb">len</span> <span class="p">(</span><span class="n">LocationRecords</span><span class="p">)</span>
    <span class="n">BusStopsCount</span> <span class="o">=</span> <span class="nb">len</span> <span class="p">(</span><span class="n">BusStopsListSouth</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">LocationRecordsCount</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">DistanceFromStop</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="o">.</span><span class="n">mydistance</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
                                              <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
                                              <span class="n">BusStopsListSouth</span><span class="p">[</span><span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;Location&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">BusStopsListSouth</span><span class="p">[</span><span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;Location&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">DistanceFromStop</span> <span class="o">&lt;</span> <span class="n">Dist_TH</span><span class="p">:</span>
                    <span class="n">BusStopIndex</span> <span class="o">+=</span><span class="n">j</span>
                    <span class="n">BusStopDict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BusStopsCount</span><span class="o">-</span><span class="n">BusStopIndex</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LocationRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span>
                    <span class="n">BusStopDict</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BusStopsListNorth</span><span class="p">[</span><span class="n">BusStopIndex</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">BusStopsTimeStampList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BusStopDict</span><span class="p">)</span>
                    <span class="n">BusStopIndex</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">BusStopIndex</span> <span class="o">==</span> <span class="n">BusStopsCount</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span><span class="p">(</span><span class="n">BusStopsTimeStampList</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will update the travel time of a trip in the MongoDB with the collection name <code class="docutils literal notranslate"><span class="pre">dd_mm_yyyy__hh_mm_ss.BusStopsRecord</span></code> in the function <code class="docutils literal notranslate"><span class="pre">addTravelTimeInformationToMongoDB</span></code>. Additionally, we update the <code class="docutils literal notranslate"><span class="pre">BusStopRecordExtracted</span></code> flag of a trip to <strong>True</strong> in the <code class="docutils literal notranslate"><span class="pre">TripInfo</span></code> collection. It would be used to retrieve only those trips for which the travel time information related to bus-stop is extracted. Furthermore, one should observe the update of <code class="docutils literal notranslate"><span class="pre">TripStartTimeAggregate</span></code> collection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Create collection to store the trip aggregate information&#39;&#39;&#39;</span>
<span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripStartTimeAggregate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update_one</span><span class="p">({},{</span><span class="s1">&#39;$addToSet&#39;</span><span class="p">:</span>
                                                         <span class="p">{</span><span class="s1">&#39;TripStartTimeBound&#39;</span><span class="p">:</span>
                                                          <span class="p">(</span><span class="n">TripInfoList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;TripStartHour&#39;</span><span class="p">],</span> <span class="n">Bound</span><span class="p">)}},</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TripStartTimeAggregate</span></code> maintains the starting time of all the trips on a particular bound using the tuple <em>(TripStartHour, Bound)</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">addTravelTimeInformationToMongoDB</span><span class="p">(</span><span class="n">SingleTripInfo</span><span class="p">,</span> <span class="n">BusStopsTimeStampList</span><span class="p">,</span> <span class="n">Bound</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    input: Trip name, bus-stop location record and bound</span>
<span class="sd">    output: void</span>
<span class="sd">    function: Stores the bus-stop location record in the MongoDB database with collection name</span>
<span class="sd">              SingleTripInfo.BusStopsRecord. It also updates the flag Bound and BusStopRecordExtracted</span>
<span class="sd">              in TripInfo collection. Further, the function updates the TripStartTimeAggregate to</span>
<span class="sd">              maintains the starting time of all the trips on a particular bound using the tuple</span>
<span class="sd">              (TripStartHour, Bound).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">TripInfoList</span> <span class="o">=</span> <span class="p">[</span><span class="n">Trip</span> <span class="k">for</span> <span class="n">Trip</span> <span class="ow">in</span>
                    <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">:</span><span class="n">SingleTripInfo</span><span class="p">})</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="sd">&#39;&#39;&#39;If travel time record of trip is not available&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">BusStopsTimeStampList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">:</span><span class="n">SingleTripInfo</span><span class="p">},</span>
                                               <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:{</span><span class="s1">&#39;Bound&#39;</span><span class="p">:</span> <span class="n">Bound</span><span class="p">,</span> <span class="s1">&#39;BusStopRecordExtracted&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;Drop if any previous records are stored in MongoDB collection&#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">]</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="n">SingleTripInfo</span><span class="o">+</span><span class="s1">&#39;.BusStopsRecord&#39;</span><span class="p">)</span>
        <span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="n">SingleTripInfo</span><span class="o">+</span><span class="s1">&#39;.BusStopsRecord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">BusStopsTimeStampList</span><span class="p">)</span>
        <span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">:</span><span class="n">SingleTripInfo</span><span class="p">},</span>
                                               <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:{</span><span class="s1">&#39;Bound&#39;</span><span class="p">:</span> <span class="n">Bound</span><span class="p">,</span> <span class="s1">&#39;BusStopRecordExtracted&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}})</span>

        <span class="sd">&#39;&#39;&#39;Create collection to store the trip aggregate information&#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripStartTimeAggregate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update_one</span><span class="p">({},{</span><span class="s1">&#39;$addToSet&#39;</span><span class="p">:</span>
                                                                 <span class="p">{</span><span class="s1">&#39;TripStartTimeBound&#39;</span><span class="p">:</span>
                                                                  <span class="p">(</span><span class="n">TripInfoList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;TripStartHour&#39;</span><span class="p">],</span> <span class="n">Bound</span><span class="p">)}},</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, given that we have built the required functions for travel time information, we can execute it for the trips on North bound and South bound.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;For Morning trips&#39;&#39;&#39;</span>
<span class="n">SingleTripsInfoNorthBound</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;$and&#39;</span><span class="p">:</span>
                                                                   <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;filteredLocationRecord&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                                                                    <span class="p">{</span><span class="s1">&#39;TripStartHour&#39;</span><span class="p">:</span><span class="s1">&#39;07&#39;</span><span class="p">}</span> <span class="p">]</span> <span class="p">})]</span>

<span class="k">for</span> <span class="n">SingleTripInfo</span> <span class="ow">in</span> <span class="n">SingleTripsInfoNorthBound</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Extracting travel time for trip: &#39;</span><span class="o">+</span> <span class="n">SingleTripInfo</span><span class="p">)</span>
    <span class="n">LocationRecords</span> <span class="o">=</span> <span class="p">[</span><span class="n">LocationRecord</span> <span class="k">for</span> <span class="n">LocationRecord</span> <span class="ow">in</span>
                       <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="n">SingleTripInfo</span><span class="o">+</span><span class="s1">&#39;.Filtered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])]</span>
    <span class="n">BusStopsTimeStampList</span> <span class="o">=</span> <span class="n">ExtractTimeStampNorthBound</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">,</span> <span class="n">BusStopsListNorth</span><span class="p">,</span> <span class="n">Dist_TH</span><span class="p">)</span>

    <span class="n">addTravelTimeInformationToMongoDB</span><span class="p">(</span><span class="n">SingleTripInfo</span><span class="p">,</span> <span class="n">BusStopsTimeStampList</span><span class="p">,</span> <span class="s1">&#39;North&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting travel time for trip: 29_01_2018__07_39_47
Extracting travel time for trip: 30_01_2018__07_42_30
Extracting travel time for trip: 01_02_2018__07_39_12
Extracting travel time for trip: 02_02_2018__07_38_50
Extracting travel time for trip: 18_01_2018__07_38_10
Extracting travel time for trip: 19_01_2018__07_38_47
Extracting travel time for trip: 22_01_2018__07_41_04
Extracting travel time for trip: 22_12_2017__07_38_21
Extracting travel time for trip: 26_12_2017__07_32_35
Extracting travel time for trip: 20_12_2017__07_38_14
Extracting travel time for trip: 21_12_2017__07_52_59
Extracting travel time for trip: 08_01_2018__07_41_43
Extracting travel time for trip: 09_01_2018__07_40_01
Extracting travel time for trip: 27_12_2017__07_55_48
Extracting travel time for trip: 29_12_2017__07_37_27
Extracting travel time for trip: 01_01_2018__07_38_27
Extracting travel time for trip: 12_02_2018__07_40_14
Extracting travel time for trip: 15_02_2018__07_45_52
Extracting travel time for trip: 16_02_2018__07_45_41
Extracting travel time for trip: 19_02_2018__07_46_19
Extracting travel time for trip: 20_02_2018__07_41_48
Extracting travel time for trip: 21_02_2018__07_42_42
Extracting travel time for trip: 13_03_2018__07_29_52
Extracting travel time for trip: 14_03_2018__07_35_46
Extracting travel time for trip: 20_03_2018__07_28_45
Extracting travel time for trip: 21_03_2018__07_32_39
Extracting travel time for trip: 22_03_2018__07_38_43
Extracting travel time for trip: 14_02_2018__07_41_04
Extracting travel time for trip: 22_02_2018__07_42_45
Extracting travel time for trip: 12_02_2018__07_40_14
Extracting travel time for trip: 15_02_2018__07_45_52
Extracting travel time for trip: 16_02_2018__07_45_41
Extracting travel time for trip: 19_02_2018__07_46_19
Extracting travel time for trip: 20_02_2018__07_41_48
Extracting travel time for trip: 21_02_2018__07_42_42
Extracting travel time for trip: 13_03_2018__07_29_52
Extracting travel time for trip: 14_03_2018__07_35_46
Extracting travel time for trip: 20_03_2018__07_28_45
Extracting travel time for trip: 21_03_2018__07_32_39
Extracting travel time for trip: 22_03_2018__07_38_43
Extracting travel time for trip: 14_02_2018__07_41_04
Extracting travel time for trip: 22_02_2018__07_42_45
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;For Evening trips&#39;&#39;&#39;</span>
<span class="n">SingleTripsInfoSouthBound</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;$and&#39;</span><span class="p">:</span>
                                                                   <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;filteredLocationRecord&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                                                                    <span class="p">{</span><span class="s1">&#39;TripStartHour&#39;</span><span class="p">:</span><span class="s1">&#39;18&#39;</span><span class="p">}</span> <span class="p">]</span> <span class="p">})]</span>
<span class="k">for</span> <span class="n">SingleTripInfo</span> <span class="ow">in</span> <span class="n">SingleTripsInfoSouthBound</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Extracting travel time for trip: &#39;</span><span class="o">+</span> <span class="n">SingleTripInfo</span><span class="p">)</span>
    <span class="n">LocationRecords</span> <span class="o">=</span> <span class="p">[</span><span class="n">LocationRecord</span> <span class="k">for</span> <span class="n">LocationRecord</span> <span class="ow">in</span>
                       <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="n">SingleTripInfo</span><span class="o">+</span><span class="s1">&#39;.Filtered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])]</span>

    <span class="n">BusStopsTimeStampList</span> <span class="o">=</span> <span class="n">ExtractTimeStampSouthBound</span><span class="p">(</span><span class="n">LocationRecords</span><span class="p">,</span> <span class="n">BusStopsListSouth</span><span class="p">)</span>

    <span class="n">addTravelTimeInformationToMongoDB</span><span class="p">(</span><span class="n">SingleTripInfo</span><span class="p">,</span> <span class="n">BusStopsTimeStampList</span><span class="p">,</span> <span class="s1">&#39;South&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting travel time for trip: 22_12_2017__18_38_34
Extracting travel time for trip: 19_12_2017__18_41_16
Extracting travel time for trip: 20_12_2017__18_31_19
Extracting travel time for trip: 08_01_2018__18_37_49
Extracting travel time for trip: 14_02_2018__18_30_22
Extracting travel time for trip: 15_02_2018__18_33_19
Extracting travel time for trip: 20_02_2018__18_31_07
Extracting travel time for trip: 28_03_2018__18_39_21
Extracting travel time for trip: 21_03_2018__18_32_40
Extracting travel time for trip: 21_02_2018__18_28_29
Extracting travel time for trip: 14_02_2018__18_30_22
Extracting travel time for trip: 15_02_2018__18_33_19
Extracting travel time for trip: 20_02_2018__18_31_07
Extracting travel time for trip: 28_03_2018__18_39_21
Extracting travel time for trip: 21_03_2018__18_32_40
Extracting travel time for trip: 21_02_2018__18_28_29
</pre></div></div>
</div>
<p>Now let us look at the <code class="docutils literal notranslate"><span class="pre">.BusStopsRecord</span></code> for one of the trips, for which <code class="docutils literal notranslate"><span class="pre">BusStopRecordExtracted</span></code> is <strong>True</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SingleTripsInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;SingleTripInfo&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span>
                             <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="s1">&#39;TripInfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;BusStopRecordExtracted&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})]</span>

<span class="k">for</span> <span class="n">SingleTripInfo</span> <span class="ow">in</span> <span class="n">SingleTripsInfo</span><span class="p">:</span>
    <span class="n">BusStopTimeStamp</span> <span class="o">=</span> <span class="p">[</span><span class="n">LocationRecord</span> <span class="k">for</span> <span class="n">LocationRecord</span> <span class="ow">in</span>
                        <span class="n">con</span><span class="p">[</span><span class="n">RouteName</span><span class="p">][</span><span class="n">SingleTripInfo</span><span class="o">+</span><span class="s1">&#39;.BusStopsRecord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])]</span>

    <span class="c1">#pprint.pprint(BusStopTimeStamp)</span>
    <span class="k">break</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BusStopTimeStamp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Name</th>
      <th>_id</th>
      <th>epoch</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>23.038331</td>
      <td>72.511583</td>
      <td>Pakwaan</td>
      <td>5da5496d52d4e7104951285d</td>
      <td>1.517192e+12</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>23.045992</td>
      <td>72.515372</td>
      <td>GuruDwara</td>
      <td>5da5496d52d4e7104951285e</td>
      <td>1.517192e+12</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>23.049854</td>
      <td>72.517070</td>
      <td>Thaltej</td>
      <td>5da5496d52d4e7104951285f</td>
      <td>1.517192e+12</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.058588</td>
      <td>72.520010</td>
      <td>Zydus</td>
      <td>5da5496d52d4e71049512860</td>
      <td>1.517192e+12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>23.076662</td>
      <td>72.525262</td>
      <td>Kargil</td>
      <td>5da5496d52d4e71049512861</td>
      <td>1.517192e+12</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>23.086117</td>
      <td>72.527993</td>
      <td>Sola</td>
      <td>5da5496d52d4e71049512862</td>
      <td>1.517193e+12</td>
      <td>6</td>
    </tr>
    <tr>
      <th>6</th>
      <td>23.098678</td>
      <td>72.531615</td>
      <td>Gota</td>
      <td>5da5496d52d4e71049512863</td>
      <td>1.517193e+12</td>
      <td>7</td>
    </tr>
    <tr>
      <th>7</th>
      <td>23.136477</td>
      <td>72.542575</td>
      <td>Vaishnodevi</td>
      <td>5da5496d52d4e71049512864</td>
      <td>1.517193e+12</td>
      <td>8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>23.160550</td>
      <td>72.556503</td>
      <td>Khoraj</td>
      <td>5da5496d52d4e71049512865</td>
      <td>1.517193e+12</td>
      <td>9</td>
    </tr>
    <tr>
      <th>9</th>
      <td>23.176030</td>
      <td>72.584007</td>
      <td>Adalaj-Uvarsad</td>
      <td>5da5496d52d4e71049512866</td>
      <td>1.517193e+12</td>
      <td>10</td>
    </tr>
    <tr>
      <th>10</th>
      <td>23.192585</td>
      <td>72.614842</td>
      <td>Sargasan</td>
      <td>5da5496d52d4e71049512867</td>
      <td>1.517194e+12</td>
      <td>11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>23.185825</td>
      <td>72.637597</td>
      <td>Raksha-shakti circle</td>
      <td>5da5496d52d4e71049512868</td>
      <td>1.517194e+12</td>
      <td>12</td>
    </tr>
    <tr>
      <th>12</th>
      <td>23.160963</td>
      <td>72.635945</td>
      <td>Bhaijipura</td>
      <td>5da5496d52d4e71049512869</td>
      <td>1.517194e+12</td>
      <td>13</td>
    </tr>
    <tr>
      <th>13</th>
      <td>23.154698</td>
      <td>72.664407</td>
      <td>PDPU</td>
      <td>5da5496d52d4e7104951286a</td>
      <td>1.517194e+12</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Here, the field <code class="docutils literal notranslate"><span class="pre">epoch</span></code> gives the time stamp corresponding to the bus-stop or a junction / crossroad.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Unit4.html" class="btn btn-neutral float-right" title="Arrival time prediction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Unit2.html" class="btn btn-neutral float-left" title="Bus-stop detection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pruthvish Rajput, Manish Chaturvedi, and Pankesh Patel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>